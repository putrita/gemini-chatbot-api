<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gemini AI Chatbot</title>
  <link rel="stylesheet" href="style.css"/> <style>
 body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; }
 .container { max-width: 600px; margin: auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        /* Menggunakan #chat-box sesuai dengan ID di HTML Anda */
 #chat-box { height: 300px; border: 1px solid #ccc; overflow-y: auto; padding: 10px; margin-bottom: 10px; background-color: #e9e9e9; border-radius: 4px;}
.message {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 4px; /* Anda bisa sesuaikan dengan style.css jika ingin border-radius: 20px */
    max-width: 70%; /* Anda bisa sesuaikan dengan style.css jika ingin max-width: 80% */
    clear: both; /* Memastikan setiap pesan ada di baris baru dan membersihkan float sebelumnya */
 }
 .user-message {
    background-color: #d1e7fd; /* Warna dari inline style sebelumnya */
    text-align: right; /* Teks di dalam bubble rata kanan */
    float: right; /* Menggeser bubble ke kanan */
 }
 .bot-message {
    background-color: #f8d7da; /* Warna dari inline style sebelumnya */
    text-align: left; /* Teks di dalam bubble rata kiri */
    float: left; /* Menggeser bubble ke kiri */
}
        /* Menggunakan #user-input sesuai dengan ID di HTML Anda */
 #user-input { width: calc(100% - 85px); padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-right: 5px;}
 button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
 button:hover { background-color: #0056b3; }
 .error-message { color: red; font-style: italic; margin-top:10px }
 </style>
</head>
<body>
  <div class="container">
    <h1>Gemini AI Chatbot</h1>
    <div id="chat-box" class="chat-box"></div>
    <form id="chat-form">
      <input type="text" id="user-input" placeholder="Ketik pesan Anda..." autocomplete="off" required />
      <button type="submit">Send</button>
    </form>
    <div id="errorMessage" class="error-message"></div>
  </div>
  <script>
    const chatForm = document.getElementById('chat-form');
    const userInputField = document.getElementById('user-input');
    const chatbox = document.getElementById('chat-box'); // Disesuaikan dengan ID di HTML Anda
    const errorMessageDiv = document.getElementById('errorMessage');

    // Fungsi untuk menambahkan pesan ke chatbox
    function addMessageToChatbox(message, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
        messageDiv.textContent = message;
        chatbox.appendChild(messageDiv);
        chatbox.scrollTop = chatbox.scrollHeight; // Auto-scroll ke bawah
    }

    chatForm.addEventListener('submit', async function(event) {
        event.preventDefault(); // Mencegah form mengirimkan data secara tradisional

        const userMessage = userInputField.value.trim();
        errorMessageDiv.textContent = ''; // Bersihkan pesan error sebelumnya

        if (!userMessage) {
            errorMessageDiv.textContent = 'Pesan tidak boleh kosong.';
            return;
        }

        addMessageToChatbox(userMessage, 'user'); // Tampilkan pesan pengguna di chatbox
        userInputField.value = ''; // Kosongkan input field

        try {
            // Pastikan URL ini benar sesuai dengan port backend Anda
            const response = await fetch('http://localhost:3000/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: userMessage }),
            });

            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch (e) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const backendErrorMessage = errorData && (errorData.reply || errorData.error) ? (errorData.reply || errorData.error) : `HTTP error! status: ${response.status}`;
                throw new Error(backendErrorMessage);
            }

            const data = await response.json();
            if (data.reply) {
                addMessageToChatbox(data.reply, 'bot'); // Tampilkan balasan bot di chatbox
            } else if (data.error) {
                errorMessageDiv.textContent = `Error dari server: ${data.error}`;
                addMessageToChatbox(`Error: ${data.error}`, 'bot');
            }

        } catch (error) {
            console.error('Fetch error:', error);
            errorMessageDiv.textContent = `Gagal mengirim pesan: ${error.message}`;
            addMessageToChatbox(`Error: ${error.message}`, 'bot');
        }
    });
  </script>
</body>
</html>
